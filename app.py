from flask import Flask, render_template, request, jsonify
import time
import openai

# ChatGPT APIの設定
openai.api_key = 'YOUR_API_KEY'  # 自分のAPIキーを設定する

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/ask', methods=['POST'])
def ask():
    name = request.form['name'],
    gender = request.form['gender'],
    age = request.form['age'],
    currentStatus = request.form['currentStatus'],
    wantToDo = request.form['wantToDo'],
    
    data = {"name":name[0], "gender":gender[0], "age":age[0], "currentStatus":currentStatus[0], "wantToDo":wantToDo[0]}
    
    # ここで質問に対する処理を行い、回答を生成する
    # response = str(question_gpt(data))
    # return jsonify(response=response)

    # ChatGPTに与えるプロンプトの設定
    prompt = f"""
        いまから伝える人物の将来像を想像してください

        氏名：{name}
        性別：{gender}
        年齢：{age}
        やりたいこと：{wantToDo}
        現状：{currentStatus}

        回答方法は以下を厳守してください
        ・1年ずつ、10年分物語形式で回答する
        ・できるだけ具体的な内容にしてください
        ・学生の場合は入学してから経過した年数に合わせて進級してください

        回答例：
        1年目：
        〜〜〜〜〜〜〜〜〜〜

        ２年目：
        〜〜〜〜〜〜〜〜〜〜

        3年目：
        〜〜〜〜〜〜〜〜〜〜

        以下、10年目まで続く
    """

    # ChatGPT APIを呼び出して回答を取得する
    response = openai.Completion.create(
        engine="gpt4-0",  # 使用するChatGPTのモデル
        prompt=prompt,
        max_tokens=1500,  # 生成するテキストの最大トークン数
        temperature=0.7,  # 生成の多様性（0から1の間の値で、0に近いほど予測可能な回答になる）
        stop=None  # 生成を停止するトリガー文字列（今回は無し）
    )

    # 生成された回答をJSON形式で返す
    return jsonify(response=response['choices'][0]['text'].strip())

def question_gpt():

    a ="""
        1年目：
        直樹は小学校5年生で、野球に夢中だった。しかし、技術面でまだ未熟であり、特に投球が苦手だった。地元の少年野球チームに所属していたが、試合での活躍は少なかった。それでも、毎日のように練習に励み、野球への情熱は人一倍強かった。

        2年目：
        小学校を卒業し、中学校1年生になった直樹は、新たな野球チームに入団した。チームメイトたちとの練習や試合を通じて、技術と理解力を少しずつ高めていった。特に投球の練習に力を入れ、少しずつ制球力が向上していった。

        3年目：
        中学校2年生になり、直樹の成長が顕著に現れ始めた。チームのエースピッチャーとして、試合での活躍が増えてきた。打撃面でも安定感が出てきており、周囲からの評価も高まっていた。地区大会ではチームを牽引し、準優勝に貢献した。

        4年目：
        中学校3年生。直樹は学校の野球部のキャプテンに選ばれた。リーダーシップを発揮し、チーム全体の結束を固めるとともに、自らも更なる成長を目指していた。県大会ではベスト4まで進出し、直樹自身も個人としても注目を集める存在となった。

        5年目：
        高校1年生になり、強豪校の野球部に入部した直樹は、さらなる高みを目指す。新たな環境での刺激があり、技術の磨き合いが日々行われていた。特にフィールディングや打撃の向上に努め、チームの中心選手として存在感を示していった。

        6年目：
        高校2年生。直樹はチームの主力選手として、県大会で優勝を果たした。その実力は全国大会でも光るものがあり、スカウトやマスコミの注目を浴びるようになった。将来を見据え、プロ野球選手としての道を具体的に考え始めていた。

        7年目：
        高校3年生。卒業間近であるが、直樹はチームを全国制覇に導くべく奮闘していた。個人としても成績を残し、ドラフト候補としての評価が高まっていた。プロ野球入りを目指し、さらなる練習と精進を重ねていた。

        8年目：
        プロ野球球団からの指名を受け、直樹はプロ野球選手としてのキャリアをスタートさせた。ルーキーイヤーながらも、チームの中で重要な役割を果たし、経験を積んでいった。厳しい環境の中での成長が、彼のプレイにさらなる深みを加えていった。

        9年目：
        プロ2年目。直樹は先発投手としての地位を確立し、チームの中心選手として成長を遂げた。リーグでも名の知れた存在となり、ファンからの支持も厚い。チームと共に目指すのは、リーグ優勝という新たな目標だ。

        10年目：
        プロ3年目。直樹はチームのエースとして、リーグ優勝に貢献した。その成績と実績が評価され、年間最優秀選手にも選ばれた。日本を代表する投手としての地位を確立し、将来は国際大会での活躍も期待される存在となった。    
    
    """
    return a

if __name__ == '__main__':
    app.run(debug=True)
